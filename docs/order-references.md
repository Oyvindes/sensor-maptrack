# Order References

This document explains the order reference system in the sensor store.

## Overview

The order reference system provides two types of references for each purchase:

1. **System-Generated Order Reference**: Automatically assigned by the system when a purchase is created
2. **Customer Reference**: Optionally provided by the customer during checkout

These references help with tracking orders, invoicing, and communication between the company and customers.

## System-Generated Order Reference

### Format

The system-generated order reference follows this format:

```
YYMM-CCC-NNNN
```

Where:
- `YYMM`: Year and month of purchase (e.g., 2503 for March 2025)
- `CCC`: First three letters of the company name, uppercase (e.g., BRI for Briks)
- `NNNN`: Sequential number, padded with zeros (e.g., 0001, 0002, etc.)

Example: `2503-BRI-0001` (First order from Briks in March 2025)

### Generation

The order reference is automatically generated by a database trigger when a new purchase is created. The trigger:

1. Extracts the year and month from the purchase date
2. Gets the first three letters of the company name
3. Finds the next sequential number for this year/month/company combination
4. Combines these elements into the reference format

## Customer Reference

The customer reference is an optional field that customers can provide during checkout. This reference:

- Can be any text string provided by the customer
- Is typically used for the customer's internal purchase order number or tracking
- Appears on invoices to help customers match payments to their internal systems

## Usage

### For Customers

1. During checkout, customers can enter their reference number in the "Your Reference Number" field
2. This reference will appear on their purchase details and invoices

### For Site-Wide Admins

1. In the "All Purchases" tab, admins can view both the system-generated order reference and customer reference
2. Admins can update the customer reference if needed (e.g., if provided after the purchase)
3. The order reference can be used for:
   - Tracking orders in the system
   - Generating invoices
   - Customer communication

## Database Schema

The order references are stored in the following columns in the `purchases` table:

- `order_reference`: System-generated reference (format: YYMM-CCC-NNNN)
- `customer_reference`: Customer-provided reference

## Implementation Details

The order reference system is implemented using:

1. Database columns to store the references
2. A PostgreSQL trigger function to generate the order reference
3. UI components to display and edit references
4. API endpoints to update references

For technical details on the implementation, see the migration file:
`supabase/migrations/20250317_add_order_references_to_purchases.sql`